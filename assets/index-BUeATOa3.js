(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const M=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.6667 9.33333C13.66 8.36 14.6667 7.19333 14.6667 5.66667C14.6667 4.69421 14.2804 3.76158 13.5928 3.07394C12.9051 2.38631 11.9725 2 11 2C9.82671 2 9.00004 2.33333 8.00004 3.33333C7.00004 2.33333 6.17337 2 5.00004 2C4.02758 2 3.09495 2.38631 2.40732 3.07394C1.71968 3.76158 1.33337 4.69421 1.33337 5.66667C1.33337 7.2 2.33337 8.36667 3.33337 9.33333L8.00004 14L12.6667 9.33333Z" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;class N{constructor(e,t,a=!1){this.cardData=e,this.onLikeToggle=t,this.isSmall=a,this.element=this.createElement()}createElement(){const e=document.createElement("div");e.className=`card ${this.isSmall?"card--small":""}`;const t=document.createElement("a");t.className="card__link",t.href=`https://openlibrary.org${this.cardData.key}}`,t.ariaLabel="Link to book",t.target="_blank",t.rel="noopener noreferrer";const a=document.createElement("img");a.className="card__img",a.src=this.cardData.cover,a.alt=this.cardData.title;const o=document.createElement("div");o.className="card__wrap";const n=document.createElement("p");n.className="card__title",n.textContent=this.cardData.title;const d=document.createElement("p");d.className="card__author",d.textContent=this.cardData.author;const c=document.createElement("span");c.className="card__year",c.textContent=this.cardData.year;const l=document.createElement("button");return l.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,l.type="button",l.ariaLabel=this.cardData.isFavorite?"Delete":"Add",l.title=this.cardData.isFavorite?"Delete":"Add",l.onclick=()=>this.onLikeToggle(this.cardData.key),e.append(t,l),t.append(a,o),o.append(n,d,c),l.innerHTML=M,e}update(e){this.cardData=e;const t=this.element.querySelector("button");t.className=`card__btn ${this.cardData.isFavorite?" card__btn--favorite":""}`,t.ariaLabel=this.cardData.isFavorite?"Delete":"Add",t.title=this.cardData.isFavorite?"Delete":"Add"}getElement(){return this.element}}class E{constructor(e,t,a=!1){this.container=e,this.onLikeToggle=t,this.itemsMap=new Map,this.isLikeList=a,this.ulEl=document.createElement("ul"),this.ulEl.className=`card-list ${this.isLikeList?"card-list--favorite":""}`,this.container.appendChild(this.ulEl)}addItem(e){if(this.itemsMap.has(e.key))return;const t=new N(e,this.onLikeToggle,this.isLikeList),a=document.createElement("li");a.className="card-list__item",a.dataset.key=e.key,a.appendChild(t.getElement()),this.ulEl.appendChild(a),this.itemsMap.set(e.key,{card:t,liEl:a})}removeItem(e){const t=this.itemsMap.get(e);t&&(t.liEl.remove(),this.itemsMap.delete(e))}updateItem(e){const t=this.itemsMap.get(e.key);t&&t.card.update(e)}hasItem(e){return this.itemsMap.has(e)}getKeys(){return Array.from(this.itemsMap.keys())}}const p="https://openlibrary.org";function y(r){if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`)}async function D(r){try{const e=await fetch(p+"/search.json?q="+r.replace(/ /g,"+"));y(e);const t=await e.json();return t.docs?t.docs:[]}catch(e){console.log(e)}}async function F(r){try{const e=await fetch(`${p}${r}.json`);y(e);const t=await e.json();return t||null}catch(e){return console.log(e),null}}async function S(r){try{const e=await fetch(`${p}${r}.json`);y(e);const t=await e.json();return t?t.name:""}catch(e){console.log(e)}}async function Z(r){try{let e="";for(let t=0;t<r.length;t++){const a=await S(r[t].author.key);a&&(e+=a+", ")}return e.slice(0,-2)}catch(e){console.log(e)}}const _="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHZpZXdCb3g9IjAgMCAyMDAgMzAwIj48cGF0aCBmaWxsPSJncmF5IiBkPSJNMCAwaDIwMHYzMDBIMHoiLz48dGV4dCB4PSIxMDAiIHk9IjE1MCIgZmlsbD0iI2ZmZiIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ObyBjb3ZlcjwvdGV4dD48L3N2Zz4=",h="no info",L="https://covers.openlibrary.org/b/id/{cover}-M.jpg";function j(r,e,t){e.length=0;for(let a=0;a<r.length;a++){const o=r[a];e.push({key:o.key,title:o.title||h,author:o.author_name?.length?o.author_name.join(", "):h,year:o.first_publish_year||h,cover:o.cover_i?L.replace("{cover}",o.cover_i):_,isFavorite:t.includes(o.key)})}return e}async function A(r){return{key:r.key,title:r.title||h,author:r.authors?await Z(r.authors):r.by_statement||h,year:r.publish_date||r.first_publish_date||h,cover:r.covers?.length?L.replace("{cover}",r.covers[0]):_,isFavorite:!0}}const k="favorite-keys",f=[],g=r=>{try{localStorage.setItem(k,JSON.stringify(r))}catch(e){console.error("Failed to save item",e)}},x=()=>{try{const r=localStorage.getItem(k);return r?JSON.parse(r):f}catch(r){return console.error("Failed to load item",r),g(f),f}};async function T(r){const e=[];let t=!1;for(let a=0;a<r.length;a++){const o=await F(r[a]);o?e.push(await A(o)):t=!0}return t&&(r=e.map(a=>a.key),g(r)),e}const W=async()=>{const r=document.querySelector(".search__input"),e=document.querySelector(".search__btn"),t=document.querySelector(".main-page__search-list"),a=document.querySelector(".favorites__qty"),o=document.querySelector(".favorites__card-list-wrap");let n="",d=[],c=x(),l=await T(c);function v(i){const u=l.find(s=>s.key===i);b.removeItem(u.key),c=c.filter(s=>s!==i),g(c),a.textContent=c.length}async function I(i){const u=r.value.trim();if(u){if(u===n){console.log("the same");return}}else{console.log("zero");return}e.disabled=!0,r.disabled=!0,e.textContent="Loading...";try{const s=await D(u);s&&(i=j(s,i,c),w(i),n=u,console.log(i))}catch(s){console.log(s)}finally{e.disabled=!1,r.disabled=!1,e.textContent="Search"}}function C(){a.textContent=c.length,l.forEach(i=>{b.addItem(i)})}function w(i){const u=i.map(s=>s.key);m.getKeys().forEach(s=>{u.includes(s)||m.removeItem(s)}),i.forEach(s=>{m.hasItem(s.key)?m.updateItem(s):m.addItem(s)})}const m=new E(t,v),b=new E(o,v,!0);e.addEventListener("click",()=>{I(d)}),C()};document.addEventListener("DOMContentLoaded",()=>{W()});
